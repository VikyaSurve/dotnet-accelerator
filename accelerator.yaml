accelerator:
  displayName: Tanzu .NET Web API
  iconUrl: https://iconape.com/wp-content/files/km/370669/svg/370669.svg
  tags:
  - C#
  - project
  options:
  - name: applicationName
    label: Application Name
    description: Application Name
    inputType: text
    defaultValue: DotnetAccelerator
    required: true
  - name: database
    dataType: string
    description: The type of database to use
    inputType: radio
    defaultValue: postgresql
    required: true
    choices:
    - value: postgresql
      text: PostgreSQL
    - value: mysql
      text: MySQL
  - name: configserver
    dataType: boolean
    description: Enable config server integration
    inputType: toggle
    defaultValue: true
    required: true
  - name: resourceserver
    dataType: boolean
    description: Enable security via JWT resource server
    inputType: toggle
    defaultValue: true
    required: true
engine:
  let:
  - name: postgresql
    expression: (#database=="postgresql")
  - name: mysql
    expression: (#database=="mysql")
  merge:
  - include:
    - '**'
    exclude:
    - .template.config/**
  - include:
    - src/DotnetAccelerator/Startup.cs
    chain:
    - type: ReplaceText
      condition: '!(#postgresql)'
      substitutions:
      - text: |-
          #if postgresql
                              case DbType.PostgreSQL:
                                  opt.UseNpgsql(connectionString);
                                  break;
          #endif
        with: "''"
    - type: ReplaceText
      condition: '#postgresql'
      substitutions:
      - text: |-
          #if postgresql
                              case DbType.PostgreSQL:
                                  opt.UseNpgsql(connectionString);
                                  break;
          #endif
        with: |-
          '                    case DbType.PostgreSQL:
                                  opt.UseNpgsql(connectionString);
                                  break;
          '
    - type: ReplaceText
      condition: '!(#mysql)'
      substitutions:
      - text: |-
          #if mysql
                              case DbType.MySQL:
                                  opt.UseNpgsql(connectionString);
                                  break;
          #endif
        with: "''"
    - type: ReplaceText
      condition: '#mysql'
      substitutions:
      - text: |-
          #if mysql
                              case DbType.MySQL:
                                  opt.UseNpgsql(connectionString);
                                  break;
          #endif
        with: |-
          '                    case DbType.MySQL:
                                  opt.UseNpgsql(connectionString);
                                  break;
          '
  - include:
    - src/DotnetAccelerator/Configuration/ConfigurationBuilderExtensions.cs
    chain:
    - type: ReplaceText
      condition: '!(#configserver)'
      substitutions:
      - text: |-
          #if configserver
          using Steeltoe.Extensions.Configuration.ConfigServer;
          #endif
        with: "''"
      - text: |-
          #if configserver
                              .EnableConfigServer(environment)
          #endif
        with: "''"
    - type: ReplaceText
      condition: '#configserver'
      substitutions:
      - text: |-
          #if configserver
          using Steeltoe.Extensions.Configuration.ConfigServer;
          #endif
        with: |-
          'using Steeltoe.Extensions.Configuration.ConfigServer;
          '
      - text: |-
          #if configserver
                              .EnableConfigServer(environment)
          #endif
        with: |-
          '                    .EnableConfigServer(environment)
          '
  - include:
    - src/DotnetAccelerator/Persistence/DbType.cs
    chain:
    - type: ReplaceText
      condition: '!(#postgresql)'
      substitutions:
      - text: |-
          #if postgresql
                  PostgreSQL,
          #endif
        with: "''"
    - type: ReplaceText
      condition: '#postgresql'
      substitutions:
      - text: |-
          #if postgresql
                  PostgreSQL,
          #endif
        with: |-
          '        PostgreSQL,
          '
    - type: ReplaceText
      condition: '!(#mysql)'
      substitutions:
      - text: |-
          #if mysql
                  MySQL,
          #endif
        with: "''"
    - type: ReplaceText
      condition: '#mysql'
      substitutions:
      - text: |-
          #if mysql
                  MySQL,
          #endif
        with: |-
          '        MySQL,
          '
